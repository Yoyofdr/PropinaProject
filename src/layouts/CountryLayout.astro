import TipCalculator from '../components/TipCalculator.astro';
import LanguageSwitcher from '../components/LanguageSwitcher.astro';
import CountryTable from '../components/CountryTable.astro';
import FaqBlock from '../components/FaqBlock.astro';
import AdsenseBlock from '../components/AdsenseBlock.astro';
import AffiliateLinks from '../components/AffiliateLinks.astro';
const { content, translations, availableLangs, currentLang, countrySlug, hreflangs } = Astro.props;
---
const socialImage = `/social/${content.slug}.jpg`;
const fs = await import('fs');
let imageExists = false;
try {
  imageExists = fs.existsSync(`public${socialImage}`);
} catch (e) {
  imageExists = false;
}
const ogImage = imageExists ? `https://www.tu-dominio.com${socialImage}` : `https://www.tu-dominio.com/social-default.jpg`;
---
<html lang={currentLang}>
  <head>
    <title>{`${translations["site_title"]} | {content.country} {Object.keys(content.tip_percentages).map(s => s.charAt(0).toUpperCase() + s.slice(1)).join(", ")} - {new Date().getFullYear()}`}</title>
    <meta name="description" content={`¿Cuánto se deja de propina en ${content.country}? Calculadora interactiva y guía actualizada ${new Date().getFullYear()} para restaurantes, hoteles, taxis, delivery y más. Descubre los porcentajes típicos y consejos locales para dejar propina en ${content.country}.`} />
    <link rel="canonical" href={`https://www.tu-dominio.com/${currentLang}/${content.slug}`} />
    {hreflangs && Object.entries(hreflangs).map(([lang, slug]) => (
      <link rel="alternate" hreflang={lang} href={`https://www.tu-dominio.com/${lang}/${slug}`} />
    ))}
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content={`${translations["site_title"]} | ${content.country}`} />
    <meta property="og:description" content={`¿Cuánto se deja de propina en ${content.country}? Calculadora y guía ${new Date().getFullYear()}.`} />
    <meta property="og:url" content={`https://www.tu-dominio.com/${currentLang}/${content.slug}`} />
    <meta property="og:site_name" content={translations["site_title"]} />
    <meta property="og:image" content={ogImage} />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={`${translations["site_title"]} | ${content.country}`} />
    <meta name="twitter:description" content={`¿Cuánto se deja de propina en ${content.country}? Calculadora y guía ${new Date().getFullYear()}.`} />
    <meta name="twitter:image" content={ogImage} />
    <script type="application/ld+json">{JSON.stringify({
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": `${translations["site_title"]} | ${content.country}`,
      "description": `¿Cuánto se deja de propina en ${content.country}? Calculadora y guía actualizada ${new Date().getFullYear()}.`,
      "inLanguage": currentLang,
      "url": `https://www.tu-dominio.com/${currentLang}/${content.slug}`
    })}</script>
    <script type="application/ld+json">{JSON.stringify({
      "@context": "https://schema.org",
      "@type": "Service",
      "serviceType": `Guía de propinas en ${content.country}`,
      "areaServed": content.country,
      "provider": { "@type": "Organization", "name": translations["site_title"] },
      "description": `Porcentajes típicos de propina en ${content.country} para restaurantes, hoteles, taxis, delivery, etc.`
    })}</script>
  </head>
  <body>
    <header>
      <nav aria-label="Breadcrumb" class="breadcrumbs">
        <ol>
          <li><a href="/">{translations["site_title"]}</a></li>
          <li aria-current="page">{content.country}</li>
        </ol>
      </nav>
      <script type="application/ld+json">{JSON.stringify({
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          {"@type": "ListItem", "position": 1, "name": translations["site_title"], "item": `https://www.tu-dominio.com/`},
          {"@type": "ListItem", "position": 2, "name": content.country, "item": `https://www.tu-dominio.com/${currentLang}/${content.slug}`}
        ]
      })}</script>
      <h1>{translations["site_title"]} - {content.country}</h1>
      <LanguageSwitcher availableLangs={availableLangs} currentLang={currentLang} countrySlug={countrySlug} translations={translations} />
    </header>
    <main>
      <h2>{content.country}: {translations["tip_calculator"]}</h2>
      <AdsenseBlock slot="main" />
      <TipCalculator tipPercentages={content.tip_percentages} translations={translations} />
      <h2>{translations["typical_tip"]} por servicio</h2>
      <CountryTable tipPercentages={content.tip_percentages} translations={translations} />
      <h2>{translations["faq"]}</h2>
      <FaqBlock faq={content.faq} translations={translations} />
      {content.related_countries && content.related_countries.length > 0 && (
        <section>
          <h2>{translations["related_countries"]}</h2>
          <ul>
            {content.related_countries.map(link => (
              <li><a href={`/${link}`}>{link.replace(/-/g, ' ')}</a></li>
            ))}
          </ul>
        </section>
      )}
      <section>
        <h2>{translations["other_countries"] || 'Países populares'}</h2>
        <ul>
          <li><a href="/es/propina-en-espana">Propina en España</a></li>
          <li><a href="/en/tipping-in-united-states-of-america">Tipping in USA</a></li>
          <li><a href="/fr/pourboire-au-france">Pourboire en France</a></li>
          <li><a href="/es/propina-en-mexico">Propina en México</a></li>
        </ul>
      </section>
      <AffiliateLinks affiliateLinks={content.affiliate_links} translations={translations} />
      <AdsenseBlock slot="footer" />
    </main>
    <footer>
      <p>&copy; {new Date().getFullYear()} {translations["site_title"]}</p>
      <p style="font-size:0.9em; color:#888;">{translations["adsense_notice"]} {translations["affiliate_notice"]}</p>
      <p style="font-size:0.9em;"><a href="/privacidad" rel="nofollow">Política de privacidad</a> | <a href="/cookies" rel="nofollow">Cookies</a></p>
    </footer>
  </body>
</html>
